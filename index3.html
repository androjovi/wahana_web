<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

<!--
    <link rel="icon" href="lib/3rdParty/bootstrap/favicon.ico">
    <title>Cover Template for Bootstrap</title>
-->
    <link rel="icon" href="favicon.ico">
    <title>Wahana Prestasi Logistik</title>

    <!-- Bootstrap core CSS -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet">
     <link href="assets/css/one.style.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="assets/css/cover.css" rel="stylesheet">
    <link href="assets/css/hover-min.css" rel="stylesheet">
    <link href="assets/css/shortcode_timeline2.css" rel="stylesheet">
    <script src="https://unpkg.com/jspdf@latest/dist/jspdf.min.js"></script>
    <!--   <script src="assets/js/html2canvas.min.js"></script> -->
    <link href="assets/css/select2.css" rel="stylesheet" />

<!--    <link href="assets/css/sticky-footer-navbar.css" rel="stylesheet"> -->
  </head>
<style>
.autocomplete-suggestions { border: 1px solid #999;text-align: left;background: #FFF; overflow: auto; }
/*.autocomplete-suggestion { padding: 2px 5px; white-space: nowrap; overflow: hidden; }*/
.autocomplete-suggestion { padding: 2px 5px; overflow: hidden; }
.autocomplete-selected { background: #F0F0F0; }
.autocomplete-suggestions strong { font-weight: normal; color: #3399FF; }
.autocomplete-group { padding: 2px 5px; }
.autocomplete-group strong { display: block; border-bottom: 1px solid #000; }

/*
.hvr-sweep-to-right::before{
  background: #0202ff;
}
.hvr-sweep-to-right:hover{
  color: white;
}
.demo{
  position: absolute;
  font-size: 10px;
}
*/
.dropdown-caret{
  position: relative;
}
.dropdown-caret::before{
  position: absolute;
  font-family: FontAwesome;
			content: " \f0d7";
      color: #444;
			top: 5px;
			height: 20px;
      left: calc(100% - 5%);
}
</style>
  <body class="text-center">
    <div class="cover-container d-flex w-100 h-100 mx-auto flex-column">
    <nav class="navbar navbar-expand-lg sticky-top">
  <a class="navbar-brand" href="#"><img class="rounded" src="wahana/images/logo-wahana.png"></a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <i class="fa fa-bars" aria-hidden="true"></i>
  </button>
  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav ml-auto">
      <li class="nav-item">
        <a class="nav-link nav-mastlink hvr-sweep-to-right" href="index.html">Beranda</a><span >&nbsp;|&nbsp;</span>
      </li>
      <li class="nav-item">
        <a class="nav-link nav-mastlink hvr-sweep-to-right" href="index.html#tariff">Cek Tarif</a><span >&nbsp;|&nbsp;</span>
      </li>
      <li class="nav-item">
        <a class="nav-link nav-mastlink hvr-sweep-to-right" href="index.html#track">Lacak Pengiriman</a><span >&nbsp;|&nbsp;</span>
      </li>
      <li class="nav-item">
        <a class="nav-link nav-mastlink hvr-sweep-to-right" href="index.html#agentloc">Agen Terdekat</a><span >&nbsp;|&nbsp;</span>
      </li>
      <li class="nav-item">
        <a class="nav-link nav-mastlink hvr-sweep-to-right" href="peluang_bisnis.html">Peluang Bisnis</a><span >&nbsp;|&nbsp;</span>
      </li>
      <li class="nav-item">
        <a class="nav-link nav-mastlink hvr-sweep-to-right" href="contactus.html">Hubungi CS</a><span >&nbsp;|&nbsp;</span>
      </li>
      <li class="nav-item">
        <a class="nav-link nav-mastlink hvr-sweep-to-right" href="cgi-bin/dw.cgi">Masuk</a>
      </li>
    </ul>
  </div>
</nav>
      <main role="main" class="inner cover pt-4 main-container mx-auto">
<div id="wahanaCarousel" class="carousel slide" data-ride="carousel">
	<ol class="carousel-indicators">
		<li data-target="#wahanaCarousel" data-slide-to="0" class="active"></li>
		<li data-target="#wahanaCarousel" data-slide-to="1"></li>
		<li data-target="#wahanaCarousel" data-slide-to="2"></li>
		<li data-target="#wahanaCarousel" data-slide-to="3"></li>
		<li data-target="#wahanaCarousel" data-slide-to="4"></li>
		<li data-target="#wahanaCarousel" data-slide-to="5"></li>
	</ol>
	<div class="carousel-inner rounded">
		<div class="carousel-item active">
			<img class="d-block w-100" src="wahana/banners/Ultah-021.jpg">
		</div>
		<div class="carousel-item">
			<img class="d-block w-100" src="wahana/banners/Banner_libur-01.jpg">
		</div>
		<div class="carousel-item">
			<img class="d-block w-100" src="wahana/banners/web_banner_ramadhan-04.jpg">
		</div>
		<div class="carousel-item">
			<img class="d-block w-100" src="wahana/banners/3000_new-01.jpg">
		</div>
		<div class="carousel-item">
			<img class="d-block w-100" src="wahana/banners/TOKPED-021.jpg">
		</div>
		<div class="carousel-item">
			<img class="d-block w-100" src="wahana/banners/New_Template-06.jpg">
		</div>
    <div class="carousel-item">
			<img class="d-block w-100" src="wahana/banners/Web_Banner_BUKALAPAK_REV_1-021.jpg">
		</div>
    <div class="carousel-item">
			<img class="d-block w-100" src="wahana/banners/banner_web_prioritas-01-01-01.jpg">
		</div>
    <div class="carousel-item">
      <img class="d-block w-100" src="wahana/banners/wahana_untuk_dari_indonesia_opsi_1_buat_web-01-01.jpg">
    </div>
    <div class="carousel-item">
      <img class="d-block w-100" src="wahana/banners/JASA_PENGIRIMAN_BARANG-01.jpg">
    </div>
	</div>
	<a class="carousel-control-prev" href="#wahanaCarousel" role="button" data-slide="prev">
		<span class="carousel-control-prev-icon" aria-hidden="true"></span>
		<span class="sr-only">Previous</span>
	</a>
	<a class="carousel-control-next" href="#wahanaCarousel" role="button" data-slide="next">
		<span class="carousel-control-next-icon" aria-hidden="true"></span>
		<span class="sr-only">Next</span>
	</a>
</div>
<div data-spy="scroll" data-target="#navbar-example2" data-offset="0" >
<div id="tariff" class="card bg-transparent mt-2">
<div class="card-body">
			<h4 class="text-center">Cek Tarif</h4>
			<form class="" action="JavaScript:void(0)">
			<div class="form-row">
				<div class="form-group col-sm-3">
					<label class="sr-only" for="serviceId">Service</label>
					<select class="form-control form-control-sm" id="service">
						<option disabled>Pick a Service</option>
						<option value="7">Domestik Normal</option>
						<option value="5">Priority</option>
						<option value="8994">Special Destination</option>
					</select>
				</div>
				<div class="form-group col-sm-3 col-md-3 col-xs-3">
					<label class="sr-only">Kota asal</label>
          <select id="calculateFrom" class="form-control">
            <option>Masukkan Kota Asal</option>
    </select>
				</div>
				<div class="form-group col-sm-6">
					<label class="sr-only">Kota tujuan</label>
          <div class="dropdown-caret">
					<input id="calculateTo" placeholder="Masukkan Kota Tujuan" class="form-control form-control-sm" type="text" >
        </div>
				</div>
			</div>
			<div class="form-row">
				<div class="form-group col-sm-2">
					<label class="sr-only">Weight</label>
					<div class="input-group">
						<input id="calculateWeight" placeholder="Berat" class="form-control form-control-sm" type="text" value="4">
						<div class="input-group-append">
							<span class="input-group-text">KG</span>
						</div>
					</div>
				</div>
					<div class="form-group col-sm-2">
						<label class="sr-only">Length</label>
						<div class="input-group">
							<input id="calculateLength" placeholder="Panjang" class="form-control form-control-sm" type="text" value="4">
							<div class="input-group-append">
								<span class="input-group-text">CM</span>
							</div>
						</div>
					</div>
					<div class="form-group col-sm-2">
						<label class="sr-only">Width</label>
						<div class="input-group">
							<input id="calculateWide" placeholder="Lebar" class="form-control form-control-sm" type="text" value="4">
							<div class="input-group-append">
								<span class="input-group-text">CM</span>
							</div>
						</div>
					</div>
					<div class="form-group col-sm-2">
						<label class="sr-only">Height</label>
						<div class="input-group">
							<input id="calculateHeight" placeholder="Tinggi" class="form-control form-control-sm" type="text" value="4">
							<div class="input-group-append">
								<span class="input-group-text">CM</span>
							</div>
						</div>
					</div>


							<input type="hidden" id="dataAsalId" placeholder="Tinggi" class="form-control form-control-sm" type="text" value="3171">

							<input type="hidden" id="dataTujuanId" placeholder="Tinggi" class="form-control form-control-sm" type="text" value="1106051010">

				<div class="form-group col-sm-4">
					<button  onClick="calculate()" class="btn btn-block btn-index">Hitung !</button>
				</div>
			</div>

      </div>
			</form>
</div>
</div>




  </main>
<style>
.row{
  position: relative;

  width: 100%
}
.col-md-12, .col-md-4{
  max-width: none;
  display: inline-grid;
}
.text-button, .btn-btn-primary{
  display: none;
}
label .from-rate-result{
  padding-top: none;
}
</style>
    <div class="modal fade fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Cek tarif</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body text-center" style="max-width:100%;" id="testing">
        <span id="first-visible" class="text-center"></span>
      </div>
      <div class="modal-footer">
          <button type="button" id="btnDownload" class="btn btn-primary">Download Image</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>


</div>

      <!-- Bootstrap core JavaScript
      ================================================== -->
      <!-- Placed at the end of the document so the pages load faster -->
      <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
      <script src="https://use.fontawesome.com/2e37f68334.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"></script>
      <script src="https://superal.github.io/canvas2image/canvas2image.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
      <script src="assets/js/jquery.autocomplete.min.js"></script>
      <script src="assets/js/main.js"></script>
      <script>window.jQuery || document.write('<script src="lib/3rdParty/bootstrap/assets/js/vendor/jquery-slim.min.js"><\/script>')</script>
      <script src="assets/js/popper.min.js"></script>
      <script src="assets/js/bootstrap.min.js"></script>

<script>
var htmlSource = $('#testing')[0];
$('#btnDownload').on("click", function() {

  html2canvas(htmlSource, {
   onrendered: function(canvas) {

     // document.body.appendChild(canvas);
     return Canvas2Image.saveAsPNG(canvas);
   }
 });
  })
</script>
      <script type="text/javascript">
      function formatState (state) {
  if (!state.id) {
    return state.text;
  }
  var state1 = state.text;
  return state1;
};
function selection(state) {
    return state.text;
}
function makeSelect2(data) {
    $('#calculateFrom').select2({
        data: data,
        placeholder : "Masukkan Kota Asal",
        templateSelection: selection,
        templateResult: formatState,
        escapeMarkup: function (state) {
            return state;
        },
    });
}
      $(document).ready(function(){
    $.ajax({
      type: "POST",
      dataType: "json",
      async: true,
      url: "https://wahana.com/Ajaxx/getTariffNodeOriginNew2",
      success: function (data) {
        data.sort(function(a, b){
    var nameA=a.text.toLowerCase(), nameB=b.text.toLowerCase()
    if (nameA < nameB) //sort string ascending
        return -1
    if (nameA > nameB)
        return 1
    return 0 //default return value (no sorting)
})
delete data.3171
console.log(data)

        makeSelect2(data);
        /*
                function sortProperties(obj)
        {
          // convert object into array
        	var sortable=[];
        	for(var key in obj)
        		if(obj.hasOwnProperty(key))
        			sortable.push([key, obj[key]]); // each item is an array in format [key, value]

        	// sort items by value
        	sortable.sort(function(a, b)
        	{
        		var x=a[1].toLowerCase(),
        			y=b[1].toLowerCase();
        		return x<y ? -1 : x>y ? 1 : 0;
        	});
        	return sortable; // array in format [ [ key1, val1 ], [ key2, val2 ], ... ]
        }
      $.map(data, function(z, obj){
          var ez = {id:obj, text:z}

          function gg(obj){
            return obj
          }
          console.log(ez)
          makeSelect2([ez]);
      })
      */
      }
  });
      })
      $('#calculateFrom').on('select2:select', function (e) {
    var data = e.params.data;
    console.log(data)
    $("#dataAsalId").attr("data-id",data.id)
    $("#dataAsalId").val(data.text)

});

      function remove_duplicates_safe(arr) {
    var seen = {};
    var ret_arr = [];
    for (var i = 0; i < arr.length; i++) {
        if (!(arr[i] in seen)) {
            ret_arr.push(arr[i]);
            seen[arr[i]] = true;
        }
    }
    return ret_arr;

}
            $('#calculateTo').keypress(function(e) {
                  var from  = $("#dataAsalId").val();
                  if(from.length == 0){
                        $('#alertModal .modal-body').html('Silahkan isi Kota Asal terlebih dahulu!');
                        $('#alertModal').modal('show');
                        return false;
                      }
              });



              function getDataOrigin(callback){
                  $.post("https://wahana.com/Ajaxx/getTariffNodeOriginNew", {}, function(data){
                      // console.log(data);
                      callback(data);
                  });
              }

              // alert(getDataOrigin(returnData));

              function autoCompletee(){
                getDataOrigin(function(data1) {
                data=JSON.parse(data1);
                var dataArray = $.map(data, function(value, key) {
                  return {
                    value: value,
                    data: key
                  };
                });
/*
                $('#calculateFrom').autocomplete({
                  minChars: 3,
                  deferRequestBy: 250,
                  noCache : true,
                  lookup: dataArray,
                  onSelect: function (suggestion) {
                      $("#dataAsalId").val(suggestion.data);
                  }
                });
*/
                var options, a;


                $('#calculateTo').autocomplete({
                    noCache : true,
                    minChars: 3,
                    dataType : "json",
                    deferRequestBy: 250,
                    serviceUrl: "https://wahana.com/Ajaxx/getTariffNodeDestinationNew",
                    params: {
                        'originNodeId': function() {
                            return $('#dataAsalId').attr("data-id");
                        },
                        'constraint': function() {
                            return $('#calculateTo').val();
                        },
                        'service': function() {
                            return $('#service').val();
                        }
                    },
                    transformResult: function(response) {

                     if(response.length ==0){

                    var service =$("#service").val();
                    var dataAsal  = $("#calculateFrom").val();
                    var dataTujuan  = $("#calculateTo").val();

                    if(service=='7'){
                      servicekirim='Normal';
                    }else if(service=='5'){
                      servicekirim='Prioritas';
                    }else{
                       servicekirim='Khusus';
                    }

                      // $('#alertModal .modal-body').html('Kota Asal  Tujuan Tidak Tersedia');
                      // $('#alertModal').modal('show');

                      $('#alertModal .modal-body').html('Layanan <b>'+servicekirim+'</b> Asal dari <b>'+dataAsal+'</b> ke <b>'+dataTujuan+' </b> Tidak Tersedia');
                      $('#alertModal').modal('show');

                     }else{
                        return {
                            suggestions: $.map(response, function(value, key) {
                              return {
                                value: value,
                                data: key
                              };
                            })
                        };
                      }
                    },
                    onSelect: function (suggestion) {
                        $("#dataTujuanId").val(suggestion.data);
                    }
                });
                });
              }
              autoCompletee();
              function clearcalculate(){
                $("#dataAsalId").val('');
                $("#dataTujuanId").val('');
                $("#calculateTo").val('');
                $("#calculateFrom").val('');
                $("#calculateWeight").val('');

                $("#calculateLength").val('');
                $("#calculateWidth").val('');
                $("#calculateHeight").val('');


              }
              function calculate(){
              var from 	= $("#dataAsalId").attr("data-id");
              var to 		= $("#dataTujuanId").val();
              var wide 	= $("#calculateWide").val();
              var height 	= $("#calculateHeight").val();
              var weight 	= $("#calculateWeight").val();
              var length 	= $("#calculateLength").val();
              var dataAsal 	= $("#dataAsalId").val();
              var dataTujuan 	= $("#calculateTo").val();
              var service =$("#service").val();

              if(service=='7'){
              servicekirim='Normal';
              }else if(service=='5'){
              servicekirim='Prioritas';
              }else{
              servicekirim='Khusus';
              }


              if(weight.length == 0 || from.length == 0 || to.length == 0  || dataAsal.length == 0 || dataTujuan.length == 0 ){
              alert("Data anda belum lengkap")
              return false;
              }

              $.post( "https://wahana.com/Ajaxx/getTarifHomeNew",
              {'from':from, 'to':to,'height':height,'weight':weight,'length':length,'dataAsal':dataAsal,'dataTujuan':dataTujuan, 'wide':wide,'service':service },
                  function() {}).done(function(data){
                    if (data != 0) {

                      console.log(dataTujuan)
                      console.log(from)
                      $("#exampleModal").modal("show")
                        $('#first-visible').html(data);
                      }
                      else {
                        alert("Layanan tidak tersedia")
                        console.log(dataAsal)
                        console.log(from)
                      }
              })

              }
              // reset calculate
              function resetCalculate(){
              $.get("https://wahana.com/Ajaxx/resetCalculate", { }, function(data) {
              $('#first-visible').html(data);
              autoCompletee();
              });
              }

      </script>


    </body>
  </html>
